@page "/add-debt"
@code {
    [Parameter]
    public bool IsVisible { get; set; }

    [Parameter]
    public EventCallback OnClose { get; set; }

    private Models.Debt newDebt = new Models.Debt();
    private int nextDebtId = 1;

    [Inject]
    private DebtDao DebtDao { get; set; }

    private void AddDebt()
    {
        // Automatically assign the Id to the new debt
        newDebt.DebtId = nextDebtId++;
        
        // Ensure DebtDueDate is after DebtTakenDate
        if (newDebt.DebtDueDate <= newDebt.DebtTakenDate)
        {
            // Handle error
            return;
        }

        DebtDao.AddDebt(newDebt);
        newDebt = new Models.Debt(); // Reset the form
        OnClose.InvokeAsync();
    }
}

@if (IsVisible)
{
    <div class="modal d-block" tabindex="-1" style="background-color: rgba(0, 0, 0, 0.5);">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Debt</h5>
                    <button type="button" class="btn-close" aria-label="Close" @onclick="() => OnClose.InvokeAsync()"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="debtAmount" class="form-label">Amount:</label>
                        <input type="number" id="debtAmount" class="form-control" @bind="newDebt.DebtAmount" />
                    </div>
                    <div class="mb-3">
                        <label for="debtTakenDate" class="form-label">Taken Date:</label>
                        <input type="date" id="debtTakenDate" class="form-control" @bind="newDebt.DebtTakenDate" />
                    </div>
                    <div class="mb-3">
                        <label for="debtDueDate" class="form-label">Due Date:</label>
                        <input type="date" id="debtDueDate" class="form-control" @bind="newDebt.DebtDueDate" />
                    </div>
                    <div class="mb-3">
                        <label for="debtSource" class="form-label">Source:</label>
                        <input type="text" id="debtSource" class="form-control" @bind="newDebt.DebtSource" />
                    </div>
                    <div class="mb-3">
                        <label for="remark" class="form-label">Remark:</label>
                        <input type="text" id="remark" class="form-control" @bind="newDebt.Remark" />
                    </div>
                    <div class="d-flex justify-content-end">
                        <button class="btn btn-primary" @onclick="AddDebt">Add</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
}